---
interface Props {
  slug?: string;
}

const { slug } = Astro.props;
---

<section class="comments">
  <h2 class="comments-title">Comments</h2>
  <div id="giscus-container">
    <script
      is:inline
      src="https://giscus.app/client.js"
      data-repo="korya/korya.dev"
      data-repo-id="R_kgDOKNBeTg"
      data-category="Announcements"
      data-category-id="DIC_kwDOKNBeTs4CzB10"
      data-mapping="pathname"
      data-strict="0"
      data-reactions-enabled="1"
      data-emit-metadata="0"
      data-input-position="top"
      data-theme="preferred_color_scheme"
      data-lang="en"
      data-loading="lazy"
      crossorigin="anonymous"
      async
    ></script>
  </div>
</section>

<style>
  .comments {
    margin-top: var(--space-xl);
    padding-top: var(--space-xl);
    border-top: 1px solid var(--color-border);
  }

  .comments-title {
    font-size: 1.25rem;
    font-weight: 600;
    margin-bottom: var(--space-lg);
  }
</style>

<script>
  // Update Giscus theme when theme toggle is clicked
  const updateGiscusTheme = () => {
    const theme = document.documentElement.getAttribute('data-theme');
    const iframe = document.querySelector<HTMLIFrameElement>('iframe.giscus-frame');
    if (iframe) {
      iframe.contentWindow?.postMessage(
        { giscus: { setConfig: { theme: theme === 'dark' ? 'dark' : 'light' } } },
        'https://giscus.app'
      );
    }
  };

  // Listen for theme changes
  const observer = new MutationObserver((mutations) => {
    mutations.forEach((mutation) => {
      if (mutation.attributeName === 'data-theme') {
        updateGiscusTheme();
      }
    });
  });

  observer.observe(document.documentElement, { attributes: true });
</script>
